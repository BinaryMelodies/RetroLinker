
Recipe([
	Assemble(Input = "{cpu_name}.s", Output = "obj/{output_file}{extension}.o", Arguments = [
		DefineSymbol("CPU_{cpu_name.upper()}"),
		DefineSymbol("TARGET_{target_name.upper()}"),
		IfDefined("format_name"),
			DefineSymbol("FORMAT_{format_name.upper()}"),
		EndIf,
		IfDefined("model_name"),
			DefineSymbol("MODEL_{model_name.upper()}"),
		EndIf,
		ForAll("option", In = "assembler_options"),
			DefineSymbol("OPTION_{option.upper().split('=')[0]}", "{'1' if '=' not in option else '='.join(option.upper().split('=')[1:])}"),
		EndFor
		], Dependency = ["../include/{include_name}.inc", "../include/common.inc"], Executable = "{output_file}{extension}"),
	Link(Format = "{linker_format_name}", Input = "obj/{output_file}{extension}.o", Output = "{output_file}{extension}", Arguments = [
		IfDefined("linker_model_name"),
			"-M{linker_model_name}",
		EndIf,
		ForAll("option", In = "linker_options"),
			"-S{option}",
		EndFor,
		ForAll("parameter", In = "linker_parameters"),
			"-P{parameter}",
		EndFor,
		IfDefined("custom_entry"),
			"-d.entry=start",
		EndIf,
		IfDefined("base_address"),
			"-Pbase_address={base_address}",
		EndIf,
		IfDefined("stub"),
			"-Sstub={stub}",
		EndIf
		], Dependency = ["{output_file}{extension}"]),
])

Target(
	System = "win16",
	Version = "gui", # superfluous, output is identical
	output_file = "win16")
Target(
	System = "win32",
	Version = "gui",
	output_file = "win32")
Target(
	System = "win64",
	Version = "gui",
	output_file = "win64")

